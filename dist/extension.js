"use strict";var D=Object.create;var w=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var P=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var $=(r,e)=>{for(var t in e)w(r,t,{get:e[t],enumerable:!0})},L=(r,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let c of I(e))!N.call(r,c)&&c!==t&&w(r,c,{get:()=>e[c],enumerable:!(i=U(e,c))||i.enumerable});return r};var v=(r,e,t)=>(t=r!=null?D(P(r)):{},L(e||!r||!r.__esModule?w(t,"default",{value:r,enumerable:!0}):t,r)),z=r=>L(w({},"__esModule",{value:!0}),r);var S={};$(S,{activate:()=>T,deactivate:()=>j});module.exports=z(S);var s=v(require("vscode")),m=v(require("path"));var y=v(require("vscode"));function C(r,e={}){if(!r||typeof r!="string")return r;try{let t=r.normalize("NFD");return t=t.replace(/[\u0300-\u036f]/g,""),Array.from(t).map(i=>e[i]||i).join("")}catch{return r}}function A(r){if(!r||typeof r!="object")return y.l10n.t("Invalid mappings: Not an object.");for(let[e,t]of Object.entries(r)){if(typeof e!="string"||e.length!==1)return y.l10n.t('Invalid key: "{key}". Keys must be single characters.',{key:e});if(typeof t!="string")return y.l10n.t('Invalid value for key "${key}": "${value}". Values must be strings.',{key:e,value:t})}return""}var R=v(require("fs")),M=v(require("path")),b=class{dictionary=new Map;ignoredWords;currentLanguage;isReady=!1;dictionaryBasePath;constructor(e,t=[]){this.currentLanguage=e,this.ignoredWords=new Set(t.map(i=>i.toLowerCase())),this.dictionaryBasePath=M.join(__dirname,"dictionary")}async initialize(){if(this.isReady)return;let e=M.join(this.dictionaryBasePath,`dict_${this.currentLanguage}.txt`),t=await this.readDictionaryFile(e);this.buildDictionary(t),this.isReady=!0}readDictionaryFile(e){return new Promise((t,i)=>{R.readFile(e,"utf8",(c,n)=>{c?i(new Error(`Dictionary file not found: ${e}. Error: ${c.message}`)):t(n)})})}buildDictionary(e){let t=e.split(`
`),i=0;for(let c=1;c<t.length;c++){let n=t[c].trim();if(!n)continue;let[o,d]=n.split("	");if(!o||!d)continue;let l=parseInt(d,10);if(isNaN(l))continue;let a=this.removeAccents(o.toLowerCase());this.dictionary.has(a)||this.dictionary.set(a,[]);let p=this.dictionary.get(a),u={word:o,frequency:l},g=0;for(;g<p.length&&p[g].frequency>l;)g++;p.splice(g,0,u),i++}console.log(`Loaded ${i} words for language ${this.currentLanguage}`)}restoreAccents(e){if(!this.isReady)throw new Error("Accent restorer not initialized. Call initialize() first.");return e.replace(/[\w\u00C0-\u017F]+/g,t=>this.ignoredWords.has(t.toLowerCase())?t:this.findBestMatch(t)||t)}findBestMatch(e){let t=this.removeAccents(e.toLowerCase()),i=this.dictionary.get(t);if(!i||i.length===0)return null;let c=i[0].word;return this.preserveOriginalCase(e,c)}removeAccents(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}preserveOriginalCase(e,t){if(e===e.toUpperCase())return t.toUpperCase();if(e===e[0].toUpperCase()+e.slice(1).toLowerCase())return t[0].toUpperCase()+t.slice(1).toLowerCase();let i="",c=Math.min(e.length,t.length);for(let n=0;n<c;n++)e[n]===e[n].toUpperCase()?i+=t[n].toUpperCase():i+=t[n].toLowerCase();if(t.length>c){let n=e[e.length-1]===e[e.length-1].toUpperCase()?"upper":"lower";for(let o=c;o<t.length;o++)i+=n==="upper"?t[o].toUpperCase():t[o].toLowerCase()}return i}async changeLanguage(e){this.dictionary.clear(),this.currentLanguage=e,this.isReady=!1,await this.initialize()}dispose(){this.dictionary.clear(),this.ignoredWords.clear(),this.isReady=!1}getMemoryUsage(){let e=Array.from(this.dictionary.values()).reduce((i,c)=>i+c.length,0);return`Dictionary: ${this.dictionary.size} base forms, ${e} total entries, Language: ${this.currentLanguage}`}};async function k(r="slovak",e=[]){let t=new b(r,e);return await t.initialize(),t}function T(r){let e;(a=>(a.ReportIssue="ps-replace-accents.reportIssue",a.ReplaceAccents="ps-replace-accents.replaceAccents",a.ReplaceAccentsFileOrFolder="ps-replace-accents.replaceAccentsFileOrFolder",a.RestoreAccents="ps-replace-accents.restoreAccents"))(e||={});let t=async(n,o=!1,d)=>{let l=s.window.activeTextEditor;if(!l)return-1;let a=l.document,p=l.selections;if(!p.length||p.every(u=>u.isEmpty)){let u=new s.Range(0,0,a.lineCount-1,a.lineAt(a.lineCount-1).text.length),g=a.getText(u),f=n(g,d);return await l.edit(h=>{h.replace(u,f)}),1}return await l.edit(u=>{for(let g of p){if(g.isEmpty)continue;let f=g;if(o){let x=a.lineAt(g.start.line),E=a.lineAt(g.end.line);f=new s.Selection(x.range.start,E.range.end)}let h=a.getText(f),F=n(h,d);u.replace(f,F)}}),0},i=async(n,o)=>{let d=n.fsPath,l=m.basename(d),a=m.dirname(d),p=C(l,o);if(p.trim().length===0)return;if(l===p){s.window.showWarningMessage(s.l10n.t("No diacritics were removed from '{0}'.",l));return}let u=m.join(a,p),g=s.Uri.file(u),f=!1;try{await s.workspace.fs.stat(g);let h=await s.window.showWarningMessage(s.l10n.t("'{0}' already exists. Do you want to overwrite it?",p),{modal:!0},s.l10n.t("Yes"),s.l10n.t("No"));if(h===s.l10n.t("Yes"))f=!0;else if(h===s.l10n.t("No"))return}catch{}try{await s.workspace.fs.rename(n,s.Uri.file(u),{overwrite:f}),s.window.showInformationMessage(s.l10n.t("Renamed: {0} to {1}",l,p))}catch(h){s.window.showErrorMessage(s.l10n.t("Failed to rename '{0}': {1}",l,h.message))}},c={"ps-replace-accents.reportIssue":()=>s.env.openExternal(s.Uri.parse("https://github.com/playfulsparkle/vscode_ps_replace_accents/issues")),"ps-replace-accents.replaceAccents":async()=>{let n=s.workspace.getConfiguration("ps-replace-accents").get("specialCharacterMappings",{}),o=A(n);if(o){s.window.showErrorMessage(o);return}let d=await t(a=>C(a,n));if(!1)switch(d){case 1:s.window.showInformationMessage(s.l10n.t("All accented characters were replaced in the selected text."));break;case 0:s.window.showInformationMessage(s.l10n.t("All accented characters were replaced in the entire document."));break}},"ps-replace-accents.replaceAccentsFileOrFolder":async(n,o)=>{if(!n)return;let d=s.workspace.getConfiguration("ps-replace-accents").get("specialCharacterMappings",{}),l=A(d);if(l){s.window.showErrorMessage(l);return}let a=o&&o.length>0?o:[n];for(let p of a)await i(p,d);a.length>1&&s.window.showInformationMessage(s.l10n.t("Diacritics removed from {0} items.",a.length))},"ps-replace-accents.restoreAccents":async()=>{let n=s.workspace.getConfiguration("ps-replace-accents").get("accentDictionary","hungarian"),o=await k(n);await t(d=>o.restoreAccents(d)),o.dispose()}};for(let[n,o]of Object.entries(c)){let d=s.commands.registerCommand(n,o);r.subscriptions.push(d)}}function j(){}0&&(module.exports={activate,deactivate});
